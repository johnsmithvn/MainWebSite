(()=>{function l(o){let e=document.getElementById("global-toast");e||(e=document.createElement("div"),e.id="global-toast",e.style.position="fixed",e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.background="#333",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="8px",e.style.zIndex="9999",e.style.fontSize="14px",document.body.appendChild(e)),e.textContent=o,e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3)}function u(o,e={}){let t=document.getElementById("global-confirm");return t||(t=document.createElement("div"),t.id="global-confirm",t.className="modal-overlay hidden",t.innerHTML=`
      <div class="modal-box">
        <p id="confirm-text"></p>
        <div class="buttons">
          <button class="ok">OK</button>
          <button class="cancel">Hu\u1EF7</button>
        </div>
      </div>
    `,document.body.appendChild(t)),t.querySelector("#confirm-text").textContent=o,t.classList.remove("hidden"),new Promise(r=>{let n=t.querySelector("button.ok"),a=t.querySelector("button.cancel"),i=()=>{t.classList.add("hidden"),n.removeEventListener("click",c),a.removeEventListener("click",s)},c=()=>{i(),e.loading&&document.getElementById("loading-overlay")?.classList.remove("hidden"),r(!0)},s=()=>{i(),r(!1)};n.addEventListener("click",c),a.addEventListener("click",s)})}function m(o,e,t){let r=document.getElementById(o);r&&(r.innerHTML="",e.forEach(n=>{let a=document.createElement("div");a.className="source-btn",a.textContent=`\u{1F4C1} ${n}`,a.onclick=async()=>{localStorage.setItem("sourceKey",n);let i=document.getElementById("loading-overlay");i?.classList.remove("hidden");try{if(t==="manga")window.location.href="/manga/select.html";else if(t==="movie")(await(await fetch(`/api/movie/movie-folder-empty?key=${n}`)).json()).empty&&await fetch("/api/movie/scan-movie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:n})}),window.location.href="/movie/index.html",i?.classList.add("hidden");else if(t==="music"){let s=await(await fetch(`/api/music/music-folder?key=${n}`)).json();(!s.total||s.total===0)&&await fetch("/api/music/scan-music",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:n})}),window.location.href="/music/index.html",i?.classList.add("hidden")}}catch(c){console.error("\u274C L\u1ED7i check/scan DB:",c),alert("L\u1ED7i khi load d\u1EEF li\u1EC7u!"),i?.classList.add("hidden")}},r.appendChild(a)}))}window.addEventListener("DOMContentLoaded",()=>{document.getElementById("loading-overlay")?.classList.add("hidden"),m("manga-list",window.mangaKeys||[],"manga"),m("movie-list",window.movieKeys||[],"movie"),m("music-list",window.musicKeys||[],"music"),f()});function f(){let o=document.getElementById("clear-storage-btn");o&&o.addEventListener("click",async()=>{await u("Xo\xE1 to\xE0n b\u1ED9 localStorage?")&&(localStorage.clear(),l("\u2705 \u0110\xE3 xo\xE1 localStorage"))})}})();
