(()=>{function h(t){let e=document.getElementById("global-toast");e||(e=document.createElement("div"),e.id="global-toast",e.style.position="fixed",e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.background="#333",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="8px",e.style.zIndex="9999",e.style.fontSize="14px",document.body.appendChild(e)),e.textContent=t,e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3)}function s(){return localStorage.getItem("sourceKey")}function y(t){let e=document.createElement("div");e.className="movie-card";let o=t.thumbnail;(!o||o==="null")&&(o=t.type==="folder"?"/default/folder-thumb.png":"/default/video-thumb.png");let n=document.createElement("img");n.className="movie-thumb",n.src=o;let a=document.createElement("div");a.className="movie-info";let c=document.createElement("div");c.className="movie-title",c.textContent=t.name,e.title=t.name;let r=document.createElement("div");r.className="movie-sub",r.textContent=t.type==="video"?"\u{1F3AC} Video file":"\u{1F4C1} Th\u01B0 m\u1EE5c",a.appendChild(c),a.appendChild(r),e.appendChild(n),e.appendChild(a);let i=document.createElement("div");return i.className="folder-fav"+(t.isFavorite?" active":""),i.title=t.isFavorite?"B\u1ECF y\xEAu th\xEDch":"Th\xEAm y\xEAu th\xEDch",i.textContent=t.isFavorite?"\u2764\uFE0F":"\u{1F90D}",i.onclick=async m=>{m.stopPropagation();let d=!t.isFavorite;t.isFavorite=d,i.classList.toggle("active",d),i.textContent=d?"\u2764\uFE0F":"\u{1F90D}",i.title=d?"B\u1ECF y\xEAu th\xEDch":"Th\xEAm y\xEAu th\xEDch";try{await fetch("/api/movie/favorite-movie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dbkey:s(),path:t.path,value:d})})}catch(v){console.warn("\u274C L\u1ED7i khi toggle favorite:",v)}},e.appendChild(i),e.onclick=()=>{let m=encodeURIComponent(t.path),d=s();t.type==="video"||t.type==="file"?window.location.href=`/movie/player.html?file=${m}&key=${d}`:window.location.href=`/movie/index.html?path=${m}`},e}var u=[],l=0,p=20;function f(){let t=document.getElementById("movie-app");t.innerHTML="";let e=document.createElement("section");e.className="folder-section";let o=document.createElement("div");o.className="folder-section-header";let n=document.createElement("h2");n.className="folder-section-title",n.textContent=`\u2764\uFE0F Phim y\xEAu th\xEDch (${u.length})`,o.appendChild(n),e.appendChild(o);let a=document.createElement("div");a.className="grid",u.slice(l*p,(l+1)*p).forEach(r=>{let i=r.thumbnail?`/video/${r.thumbnail.replace(/\\/g,"/")}`:r.type==="video"||r.type==="file"?"/default/video-thumb.png":"/default/folder-thumb.png",m=y({...r,thumbnail:i});a.appendChild(m)}),e.appendChild(a),t.appendChild(e),C(),console.log(getComputedStyle(a).display)}function C(){let t=document.getElementById("movie-app"),e=Math.ceil(u.length/p),o=document.createElement("div");o.className="reader-controls";let n=document.createElement("button");n.textContent="\u2B05 Trang tr\u01B0\u1EDBc",n.disabled=l<=0,n.onclick=()=>{l--,f()},o.appendChild(n);let a=document.createElement("div");a.textContent=`Trang ${l+1} / ${e}`,o.appendChild(a);let c=document.createElement("button");c.textContent="Trang sau \u27A1",c.disabled=l+1>=e,c.onclick=()=>{l++,f()},o.appendChild(c),t.appendChild(o)}async function S(){let t=s();if(!t)return h("\u274C Thi\u1EBFu sourceKey");document.getElementById("loading-overlay")?.classList.remove("hidden");try{u=await(await fetch(`/api/movie/favorite-movie?key=${encodeURIComponent(t)}`)).json(),l=0,f()}catch(e){h("\u274C L\u1ED7i khi t\u1EA3i danh s\xE1ch y\xEAu th\xEDch phim"),console.error("favorite-movie.js error:",e)}finally{document.getElementById("loading-overlay")?.classList.add("hidden")}}window.addEventListener("DOMContentLoaded",S);})();
